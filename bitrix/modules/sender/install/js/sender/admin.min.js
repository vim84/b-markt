function GroupManager(e,t){var n=BX(t+"_EXISTS");var i=BX(t);var r=BX(t+"_HIDDEN");var a=BX.findChildren(i,{tag:"option"});if(e){var o=BX.findChildren(n,{tag:"option"});if(o&&o.length>0){var s=[];var l;for(var d in a){l=a[d];if(!l)continue;s.push(l.value)}var c;for(var d in o){l=o[d];if(!l||!l.selected)continue;if(!BX.util.in_array(l.value,s)){c=l.cloneNode(true);i.appendChild(c)}}}}else{var u;var f;var m=[];if(a&&a.length>0){for(var d in a){if(a[d]&&a[d].selected){m.push(a[d])}}}while(m.length>0){u=m.pop();f=u.parentNode;if(f)f.removeChild(u)}}var h;var v="";var _=[];a=BX.findChildren(i,{tag:"option"});for(var d in a){h=a[d];if(h&&h!="undefined"){if(h.value!="undefined"&&parseInt(h.value)>0&&!BX.util.in_array(h.value,_)){v=v+h.value+",";_.push(h.value)}}}r.value=v}function ConnectorGetHtmlForm(e){var t=document.getElementById("connector-template");var n=t.innerHTML;for(var i in e){n=n.replace(new RegExp(i,"g"),e[i])}return n}function ConnectorSettingWatch(){var e=document.getElementsByName("post_form");var t=e[e.length-1].elements;var n;for(var i in t){n=t[i];if(n&&n.name&&BX.type.isString(n.name)&&n.name.substring(0,11)=="CONNECTOR_S"){BX.unbindAll(BX(n));BX.bind(BX(n),"change",function(){ConnectorSettingGetCount(this)})}}}function ConnectorSettingShowToggle(e,t){if(e)t=BX.findParent(e,{tag:"div",className:"connector_form"},true);BX.toggleClass(t,"sender-box-list-item-hidden")}function ConnectorSettingDelete(e){var t=BX.findParent(e,{tag:"div",className:"connector_form"},true);var n=new BX.easing({duration:500,start:{height:100,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.transitions.quart,step:function(e){t.style.opacity=e.opacity/100},complete:function(){BX.remove(t);ConnectorCounterSummary()}});n.animate()}function ConnectorSettingGetCount(e,t){var n={};var i;var r;if(t){r=t}else{r=BX.findParent(e,{tag:"div",className:"connector_form"},true)}var a=document.getElementsByName("post_form");var o=a[a.length-1].elements;var s;for(var l in o){s=o[l];if(s&&s.name&&BX.type.isString(s.name)&&s.name.substring(0,11)=="CONNECTOR_S"){i=BX.findParent(s,{tag:"div",className:"connector_form"},true);if(i==r){n[s.name]=s.value}}}BX.ajax({url:"sender_group_count.php",method:"POST",data:n,dataType:"json",timeout:30,async:true,processData:true,onsuccess:function(e){var t=BX.findChild(r,{className:"connector_form_counter"},true);if(t){t.innerHTML=e.COUNT;ConnectorCounterSummary()}}})}function addNewConnector(){var e=connectorListToAdd[BX("connector_list_to_add").value]["NAME"];var t=connectorListToAdd[BX("connector_list_to_add").value]["FORM"];t=t.replace(new RegExp("%CONNECTOR_NUM%","g"),Math.floor(Math.random()*(1e4-100+1))+100);var n=ConnectorGetHtmlForm({"%CONNECTOR_NAME%":e,"%CONNECTOR_COUNT%":"0","%CONNECTOR_FORM%":t});var i=BX.processHTML(n);var r=document.createElement("div");r.innerHTML=i.HTML;var a=BX.findChild(r,{tag:"div"});var o=BX("connector_form_container");newConnectorNodeDisplay=a.style.display;a.style.display="none";o.insertBefore(a,o.firstChild);if(i.SCRIPT.length>0){var s;for(var l in i["SCRIPT"]){s=i["SCRIPT"][l];BX.evalGlobal(s.JS)}}ConnectorSettingShowToggle(false,a);var d=new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:100,opacity:100},transition:BX.easing.transitions.quart,step:function(e){a.style.opacity=e.opacity/100;a.style.display=newConnectorNodeDisplay},complete:function(){}});d.animate();ConnectorSettingGetCount(null,a);ConnectorSettingWatch()}function ConnectorCounterSummary(){var e=0;var t=0;var n=BX("connector_form_container");var i=BX.findChildren(n,{className:"connector_form_counter"},true);for(var r in i){e=parseInt(i[r].innerHTML);if(!isNaN(e))t+=e}BX("sender_group_address_counter").innerHTML=t}function SetAddressToControl(e,t,n){var i=BX(e);if(n)i.value+=t;else i.value=t}function ProcessAddressToControl(e,t,n){t=BX.util.trim(t);var i=BX(e);var r=[];var a=[];if(i.value)r=i.value.split(",");var o=false;for(var s in r){addressFromList=BX.util.trim(r[s]);if(addressFromList==t){o=true;if(!n)a.push(addressFromList)}else{a.push(addressFromList)}}if(!o&&!n)a.push(t);i.value=a.join(", ")}function DeleteAddressFromControl(e,t){ProcessAddressToControl(e,t,true)}function AddAddressToControl(e,t){ProcessAddressToControl(e,t,false)}function SetSendType(){var e=BX("chain_send_type").value;var t=BX.findChildren(BX("chain_send_type_list_container"),{className:"sender-box-list-item"},true);for(var n in t){if(t[n].id!="chain_send_type_"+e)t[n].style.display="none";else t[n].style.display="block"}BX("SEND_TYPE").value=e;BX("sender_wizard_chain_send_type_btn").disabled=true;BX("chain_send_type").disabled=true}function DeleteSelectedSendType(e){BX.findParent(e,{className:"sender-box-list-item"}).style.display="none";BX("SEND_TYPE").value="";BX("sender_wizard_chain_send_type_btn").disabled=false;BX("chain_send_type").disabled=false}function SenderLetter(){var e;var t;this.init=function(e){this.container=BX(e.container);var t=this;var n,i,r;t.changeTemplateList("BASE");n=BX.findChildren(this.container,{className:"sender-template-type-selector-button"},true);for(r in n){if(!n[r])continue;i=n[r];BX.bind(i,"click",function(){var e="BASE";var n;for(var i in this.attributes){if(!this.attributes[i])continue;n=this.attributes[i];if(n.nodeName=="bxsendertype")e=n.nodeValue}t.changeTemplateList(e)})}n=BX.findChildren(this.container,{className:"sender-template-list-block-selector"},true);for(r in n){if(!n[r])continue;i=n[r];BX.bind(i,"click",function(){var e="BASE",n=0;var i;for(var r in this.attributes){if(!this.attributes[r])continue;i=this.attributes[r];if(i.nodeName=="bxsendertype")e=i.nodeValue;else if(i.nodeName=="bxsendernum")n=i.nodeValue}t.setTemplate(e,n)})}n=BX.findChildren(this.container,{className:"sender-template-message-caption-container-btn"},true);for(r in n){if(!n[r])continue;i=n[r];BX.bind(i,"click",function(){if(confirm(BX.message("SENDER_SHOW_TEMPLATE_LIST"))){BX.onCustomEvent(t.container,"onSenderMailingTemplateListShow")}})}return this};this.setTemplateContainer=function(e){this.container=BX(e);return this};this.onSetTemplate=function(e){BX.addCustomEvent(this.container,"onSenderMailingTemplateSet",e)};this.setTemplate=function(e,t){if(!this.container)return;BX.onCustomEvent(this.container,"onSenderMailingTemplateSet");var n=new SenderLetterManager;var i=n.getTemplateListByType(e,t);var r=BX.findChild(this.container,{className:"sender-template-message-caption-container"},true);if(r)r.innerHTML=i.NAME;this.putMessage(i.HTML,true);return this};this.changeTemplateList=function(e){if(!this.container)return;t=BX.findChild(this.container,{className:"sender-template-cont"},true);if(!t)return;var n=BX.findChildren(t,{className:"sender-template-list-type-container"},true);for(var i in n)n[i].style.display="none";var r=BX.findChild(t,{className:"sender-template-list-type-container-"+e},true);r.style.display="table-row";var a=BX.findChildren(t,{className:"sender-template-type-selector-button"},true);for(var o in a){if(!BX.hasClass(a[o],"sender-template-type-selector-button-type-"+e))BX.removeClass(a[o],"sender-template-type-selector-button-selected");else BX.addClass(a[o],"sender-template-type-selector-button-selected")}};this.putMessage=function(e,t){var n=false;if(!this.container)return;var i=BX.findChild(this.container,{className:"typearea"},true);var r,a;var o;for(var s in i.attributes){if(!i.attributes[s])continue;o=i.attributes[s];if(o.nodeName=="id")r=o.nodeValue;else if(o.nodeName=="name")a=o.nodeValue}var l;if(window.BXHtmlEditor)l=window.BXHtmlEditor.Get(a);var d=BX(r);if(l)n=l.IsShown();if(n){if(t){l.SetContent(e,true)}else{l.InsertHtml(e)}}else{if(t){d.value=e}else{d.value+=e}BX.fireEvent(d,"change")}}}function SenderLetterManager(){if(SenderLetterManager.instance){return SenderLetterManager.instance}this.list={};this.templateListByType={};this.mailBlockList={};_this=this;BX.addCustomEvent("OnEditorInitedAfter",function(e){e.components.SetComponentIcludeMethod("EventMessageThemeCompiler::includeComponent");e.config.mailblocks=_this.getMailBlockList();e.mailblocks=new BXHtmlEditor.BXEditorMailBlocks(e);e.mailblocksTaskbar=new BXHtmlEditor.MailBlocksControl(e,e.taskbarManager);e.taskbarManager.AddTaskbar(e.mailblocksTaskbar);e.taskbarManager.ShowTaskbar(e.mailblocksTaskbar.GetId());e.mailContentParsed={header:"",footer:""};BX.addCustomEvent(e,"OnParse",BX.delegate(function(e){if(!e){var t=this.content;t.replace(/(^[\s\S]*?)(<body.*?>)/i,BX.delegate(function(e){this.mailContentParsed.header=e;return""},this));t=t.replace(/(<\/body>[\s\S]*?$)/i,BX.delegate(function(e){this.mailContentParsed.footer=e;return""},this));this.content=t}}),this);BX.addCustomEvent(e,"OnAfterParse",BX.delegate(function(t){if(t){var n=this.content;n=n.replace(/^[\s\S]*?<body.*?>/i,"");n=n.replace(/<\/body>[\s\S]*?$/i,"");if(this.mailContentParsed.header!=""&&this.mailContentParsed.footer!=""){n=this.mailContentParsed.header+n+this.mailContentParsed.footer}else{n=e.content}this.content=n}}),this)});this.add=function(e,t){var n=new SenderLetter;n.id=e;n.init(t);this.list[e]=n;return n};this.get=function(e){if(this.list[e])return this.list[e];else return null};this.onSetTemplate=function(e){BX.addCustomEvent("onSenderMailingTemplateSet",e)};this.onShowTemplateList=function(e){BX.addCustomEvent("onSenderMailingTemplateListShow",e)};this.setTemplateListByType=function(e){this.templateListByType=e};this.getTemplateListByType=function(e,t){if(t!==null)return this.templateListByType[e][t];else if(e!==null)return this.templateListByType[e];else return this.templateListByType};this.setMailBlockList=function(e){this.mailBlockList=e};this.getMailBlockList=function(){return this.mailBlockList};SenderLetterManager.instance=this}function SenderLetterContainer(e){if(SenderLetterContainer.instance){return SenderLetterContainer.instance}this.deleteItem=function(e){var t=new BX.easing({duration:500,start:{height:100,opacity:100},finish:{height:0,opacity:0},transition:BX.easing.transitions.quart,step:function(t){e.style.opacity=t.opacity/100},complete:BX.delegate(function(){this.removeDraggableItem(e);BX.remove(e);this.sortItems()},this)});t.animate()};this.addItem=function(e){formContainer=this.container;var t=Math.floor(Math.random()*(1e4-100+1))+100;var n=letterTemplate.FIELDS.MESSAGE.replace(new RegExp("SENDER_LETTER_TEMPLATE_MESSAGE","g"),"CHAIN_MESSAGE_"+t);var i=letterTemplate.BODY.replace(new RegExp("%SENDER_LETTER_TEMPLATE_BODY_NUM%","g"),t);i=i.replace(new RegExp("%SENDER_LETTER_TEMPLATE_MESSAGE%","g"),n);var r=BX.processHTML(i);var a=document.createElement("div");a.innerHTML=r.HTML;var o=BX.findChild(a,{tag:"div"});var s;if(e)s=BX.findNextSibling(e);o.style.display="none";if(s){formContainer.insertBefore(o,s)}else{formContainer.appendChild(o)}this.addListenerControlItem(o);this.setTimeText(o);this.addDraggableItem(o);this.sortItems();var l=new BX.easing({duration:500,start:{height:0,opacity:0},finish:{height:100,opacity:100},transition:BX.easing.transitions.quart,step:function(e){o.style.opacity=e.opacity/100;o.style.display="block"},complete:function(){}});l.animate();if(r.SCRIPT.length>0){var d;for(var c in r["SCRIPT"]){d=r["SCRIPT"][c];BX.evalGlobal(d.JS)}}};this.toggleShow=function(e,t,n,i){if(!e&&n){e=n.querySelector(".sender_letter_container_body")}if(!t&&n){t=n.querySelector(".sender_letter_container_button_show")}if(e&&t){if(i===null){if(e.style.display=="none")i=true;else i=false}BX.removeClass(t,"sender_letter_container_button_hide");if(i){e.style.display="";t.innerHTML=BX.message("SENDER_MAILING_TRIG_LETTER_MESSAGE_HIDE");BX.addClass(t,"sender_letter_container_button_hide")}else{e.style.display="none";t.innerHTML=BX.message("SENDER_MAILING_TRIG_LETTER_MESSAGE_SHOW")}}};this.addListenerControlItem=function(e){if(!e||!e.querySelector)return;var t=e.querySelector(".sender_letter_container_button_show");var n=e.querySelector(".sender_letter_container_body");if(t&&n){BX.bind(t,"click",BX.delegate(function(){this.toggleShow(n,t,null,null)},this))}var i=e.querySelector(".sender_letter_container_button_delete");if(i){BX.bind(i,"click",BX.delegate(function(){this.deleteItem(e)},this))}var r=e.querySelector(".sender_letter_container_subject");var a=e.querySelector(".sender_letter_container_caption");if(r&&a){BX.bind(r,"input",function(){a.innerHTML=r.value});BX.bind(r,"change",function(){a.innerHTML=r.value})}var o=e.querySelector(".sender_letter_container_time_button");if(o){BX.bind(o,"click",BX.delegate(function(){this.showTimeDialog(e,o)},this))}};this.initListenerControls=function(){var e=this.container.children;for(var t in e){this.addListenerControlItem(e[t])}};this.addDraggableItem=function(e){if(!this.dragdrop)return;this.dragdrop.addSortableItem(e);this.dragdrop.bindDragItem([e])};this.removeDraggableItem=function(e){if(!this.dragdrop)return;this.dragdrop.removeSortableItem(e)};this.initDraggableItems=function(){var e=this;this.dragdrop=BX.DragDrop.create({dragItemClassName:"sender-trigger-chain-container-letter",dragItemControlClassName:"sender_letter_container_head",sortable:{rootElem:BX("SENDER_TRIGGER_CHAIN_CONTAINER"),gagClass:"senderdrag",gagHtml:""},dragStart:function(t,n,i){e.toggleShow(null,null,n,false);BX.addClass(e.container,"sendercontdrag")},dragEnd:function(t,n,i){BX.removeClass(e.container,"sendercontdrag");e.sortItems();e.initTimeText();e.repairEditor(n)}})};this.repairEditor=function(e){var t=BX.findChild(e,{className:"typearea"},true);var n,i;var r;for(var a in t.attributes){if(!t.attributes[a])continue;r=t.attributes[a];if(r.nodeName=="id")n=r.nodeValue;else if(r.nodeName=="name")i=r.nodeValue}var o;if(window.BXHtmlEditor)o=window.BXHtmlEditor.Get(i);var s=BX(n);if(!o){return}setTimeout(function(){o.CheckAndReInit()},100)};this.initTimeText=function(){var e=this.container.children;for(var t in e){this.setTimeText(e[t])}};this.sortItems=function(){var e=this.container.children;var t;var n;var i=1;for(var r in e){if(!e[r]||!e[r].querySelectorAll)continue;t=e[r].querySelector("input.sender_letter_container_sorter[type=hidden]");n=e[r].querySelector(".sender_letter_container_sorter_text");if(t&&n){t.value=i;n.innerHTML=i;i++}}};this.showTimeDialog=function(e,t){var n=BX.PopupWindowManager.create("sender-letter-container-time-dialog",t,{darkMode:false,closeIcon:true,content:BX("SENDER_TIME_DIALOG"),className:"adm-workarea"});n.close();n.setBindElement(t);var i=BX("SENDER_TIME_DIALOG_BTN_CANCEL");var r=BX("SENDER_TIME_DIALOG_BTN_SAVE");n.close();BX.unbindAll(i);BX.bind(i,"click",function(){n.close()});BX.unbindAll(r);BX.bind(r,"click",BX.delegate(function(){this.setTimeItem(e);this.setTimeText(e);n.close()},this));this.setTimeToDialog(e);n.show()};this.setTimeText=function(e){if(!e||!e.querySelector)return;var t=e.querySelector(".sender_letter_container_time");var n=e.querySelector(".sender_letter_container_time_text");var i=e.querySelector(".sender_letter_container_time_text_first");var r=e.querySelector(".sender_letter_container_time_text_nonfirst");var a=this.convertTime(t.value);n.innerHTML=a.VALUE+" "+a.TEXT;if(this.container.children[0]==e){BX(i).style.display="";r.style.display="none"}else{BX(i).style.display="none";r.style.display=""}};this.setTimeToDialog=function(e){if(!e||!e.querySelector)return;var t=BX("SENDER_TIME_DIALOG_TYPE");var n=BX("SENDER_TIME_DIALOG_VALUE");var i=e.querySelector(".sender_letter_container_time");var r=this.convertTime(i.value);t.value=r.TYPE;n.value=r.VALUE};this.setTimeItem=function(e){if(!e||!e.querySelector)return;var t=BX("SENDER_TIME_DIALOG_TYPE");var n=BX("SENDER_TIME_DIALOG_VALUE");var i=e.querySelector(".sender_letter_container_time");i.value=this.convertTime(null,{TYPE:t.value,VALUE:n.value})};this.convertTime=function(e,t){var n;if(e!==null){e=parseInt(e);if(isNaN(e)||e==0)e=0;if(e!=0)for(n in dictionarySenderTime){if(e%dictionarySenderTime[n].VALUE===0){return{TYPE:dictionarySenderTime[n].TYPE,VALUE:e/dictionarySenderTime[n].VALUE,TEXT:dictionarySenderTime[n].TEXT}}}var i=dictionarySenderTime[dictionarySenderTime.length-1];return{TYPE:i.TYPE,VALUE:0,TEXT:i.TEXT}}else{var r=parseInt(t.VALUE);if(isNaN(r))r=0;for(n in dictionarySenderTime){if(dictionarySenderTime[n].VALUE&&dictionarySenderTime[n].TYPE==t.TYPE){return r*dictionarySenderTime[n].VALUE}}return 0}};this.container=e.container;this.initListenerControls();this.initTimeText();this.initDraggableItems();SenderLetterContainer.instance=this}
//# sourceMappingURL=admin.map.js