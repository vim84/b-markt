(function(){var e=window.BX;if(e.SocNetLogDestination)return;e.SocNetLogDestination={popupWindow:null,popupSearchWindow:null,createSocNetGroupWindow:null,sendEvent:true,extranetUser:false,obSearchFirstElement:null,searchTimeout:null,createSonetGroupTimeout:null,obAllowAddSocNetGroup:{},obNewSocNetGroupCnt:{},obDepartmentEnable:{},obSonetgroupsEnable:{},obLastEnable:{},obWindowClass:{},obWindowCloseIcon:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obUserSearchArea:{},obItems:{},obItemsLast:{},obItemsSelected:{},obCallback:{},obElementSearchInput:{},obElementBindMainPopup:{},obElementBindSearchPopup:{},obSiteDepartmentID:{},obCrmFeed:{}};e.SocNetLogDestination.init=function(t){if(!t.name)t.name="lm";e.SocNetLogDestination.obPathToAjax[t.name]=!t.pathToAjax?"/bitrix/components/bitrix/main.post.form/post.ajax.php":t.pathToAjax;e.SocNetLogDestination.obCallback[t.name]=t.callback;e.SocNetLogDestination.obElementBindMainPopup[t.name]=t.bindMainPopup;e.SocNetLogDestination.obElementBindSearchPopup[t.name]=t.bindSearchPopup;e.SocNetLogDestination.obElementSearchInput[t.name]=t.searchInput;e.SocNetLogDestination.obDepartmentSelectDisable[t.name]=t.departmentSelectDisable==true?true:false;e.SocNetLogDestination.obUserSearchArea[t.name]=e.util.in_array(t.userSearchArea,["I","E"])?t.userSearchArea:false;e.SocNetLogDestination.obDepartmentLoad[t.name]={};e.SocNetLogDestination.obWindowClass[t.name]=!t.obWindowClass?"bx-lm-socnet-log-destination":t.obWindowClass;e.SocNetLogDestination.obWindowCloseIcon[t.name]=typeof t.obWindowCloseIcon=="undefined"?true:t.obWindowCloseIcon;e.SocNetLogDestination.extranetUser=t.extranetUser;e.SocNetLogDestination.obCrmFeed[t.name]=t.isCrmFeed;e.SocNetLogDestination.obAllowAddSocNetGroup[t.name]=t.allowAddSocNetGroup===true?true:false;e.SocNetLogDestination.obSiteDepartmentID[t.name]=typeof t.siteDepartmentID!="undefined"&&parseInt(t.siteDepartmentID)>0?parseInt(t.siteDepartmentID):false;e.SocNetLogDestination.obNewSocNetGroupCnt[t.name]=0;e.SocNetLogDestination.obLastEnable[t.name]=t.lastTabDisable==true?false:true;e.SocNetLogDestination.obDepartmentEnable[t.name]=false;if(t.items.department){for(var o in t.items.department){e.SocNetLogDestination.obDepartmentEnable[t.name]=true;break}}e.SocNetLogDestination.obSonetgroupsEnable[t.name]=false;if(t.items.sonetgroups){for(var o in t.items.sonetgroups){e.SocNetLogDestination.obSonetgroupsEnable[t.name]=true;break}}e.SocNetLogDestination.obItems[t.name]=e.clone(t.items);e.SocNetLogDestination.obItemsLast[t.name]=e.clone(t.itemsLast);e.SocNetLogDestination.obItemsSelected[t.name]=e.clone(t.itemsSelected);for(var n in e.SocNetLogDestination.obItemsSelected[t.name]){var i=e.SocNetLogDestination.obItemsSelected[t.name][n];e.SocNetLogDestination.runSelectCallback(n,i,t.name)}if(typeof t.LHEObjName!="undefined"&&e("div"+t.LHEObjName)){e.addCustomEvent(e("div"+t.LHEObjName),"OnShowLHE",function(t){if(!t){if(e.SocNetLogDestination.isOpenDialog()){e.SocNetLogDestination.closeDialog()}e.SocNetLogDestination.closeSearch()}})}};e.SocNetLogDestination.reInit=function(t){for(var o in e.SocNetLogDestination.obItemsSelected[t]){var n=e.SocNetLogDestination.obItemsSelected[t][o];e.SocNetLogDestination.runSelectCallback(o,n,t)}};e.SocNetLogDestination.openDialog=function(t,o){if(!t)t="lm";if(!o)o={};if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.close();if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close();return false}e.SocNetLogDestination.popupWindow=new e.PopupWindow("BXSocNetLogDestination",o.bindNode||e.SocNetLogDestination.obElementBindMainPopup[t].node,{autoHide:true,zIndex:100,offsetLeft:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetTop),bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[t]?{top:"12px",right:"15px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].openDialog)e.SocNetLogDestination.obCallback[t].openDialog(t)},onPopupClose:function(){this.destroy()},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupWindow=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].closeDialog)e.SocNetLogDestination.obCallback[t].closeDialog(t)},this)},content:'<div class="bx-finder-box bx-lm-box '+e.SocNetLogDestination.obWindowClass[t]+'" style="min-width: 450px; padding-bottom: 8px;">'+(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&!e.SocNetLogDestination.obDepartmentEnable[t]?"":'<div class="bx-finder-box-tabs">'+(e.SocNetLogDestination.obLastEnable[t]?'<a hidefocus="true" onclick="return BX.SocNetLogDestination.SwitchTab(\''+t+'\', this, \'last\')" class="bx-finder-box-tab bx-lm-tab-last bx-finder-box-tab-selected" href="#switchTab">'+e.message("LM_POPUP_TAB_LAST")+"</a>":"")+(e.SocNetLogDestination.obSonetgroupsEnable[t]?'<a hidefocus="true" onclick="return BX.SocNetLogDestination.SwitchTab(\''+t+'\', this, \'group\')" class="bx-finder-box-tab bx-lm-tab-sonetgroup" href="#switchTab">'+e.message("LM_POPUP_TAB_SG")+"</a>":"")+(e.SocNetLogDestination.obDepartmentEnable[t]?'<a hidefocus="true" id="destDepartmentTab_'+t+'" onclick="return BX.SocNetLogDestination.SwitchTab(\''+t+'\', this, \'department\')" class="bx-finder-box-tab bx-lm-tab-department" href="#switchTab">'+(e.SocNetLogDestination.obUserSearchArea[t]=="E"?e.message("LM_POPUP_TAB_STRUCTURE_EXTRANET"):e.message("LM_POPUP_TAB_STRUCTURE"))+"</a>":"")+'</div><div class="popup-window-hr popup-window-buttons-hr"><i></i></div>')+'<div class="bx-finder-box-tabs-content bx-finder-box-tabs-content-window">'+'<table class="bx-finder-box-tabs-content-table">'+"<tr>"+'<td class="bx-finder-box-tabs-content-cell">'+(e.SocNetLogDestination.obLastEnable[t]?'<div class="bx-finder-box-tab-content bx-lm-box-tab-content-last'+(e.SocNetLogDestination.obLastEnable[t]?" bx-finder-box-tab-content-selected":"")+'">'+e.SocNetLogDestination.getItemLastHtml(false,false,t)+"</div>":"")+(e.SocNetLogDestination.obSonetgroupsEnable[t]?'<div class="bx-finder-box-tab-content bx-lm-box-tab-content-sonetgroup'+(!e.SocNetLogDestination.obLastEnable[t]&&e.SocNetLogDestination.obSonetgroupsEnable[t]?" bx-finder-box-tab-content-selected":"")+'"></div>':"")+(e.SocNetLogDestination.obDepartmentEnable[t]?'<div class="bx-finder-box-tab-content bx-lm-box-tab-content-department'+(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&e.SocNetLogDestination.obDepartmentEnable[t]?" bx-finder-box-tab-content-selected":"")+'"></div>':"")+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"});e.SocNetLogDestination.popupWindow.setAngle({});e.SocNetLogDestination.popupWindow.show();if(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&e.SocNetLogDestination.obDepartmentEnable[t]&&e("destDepartmentTab_"+t))e.SocNetLogDestination.SwitchTab(t,e("destDepartmentTab_"+t),"department")};e.SocNetLogDestination.search=function(t,o,n,i,a){if(!n)n="lm";if(!a)a={};o=o==false?false:true;if(e.SocNetLogDestination.extranetUser){o=false}var s=typeof a.bTranslated!="undefined"?a.bTranslated:false;e.SocNetLogDestination.obSearchFirstElement=null;if(t.length<=0){clearTimeout(e.SocNetLogDestination.searchTimeout);if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}return false}else{var c={groups:{},users:{},sonetgroups:{},department:{},contacts:{},companies:{},leads:{},deals:{}};var r=0;var l=[];var d=[];var p=false;var m=false;for(var b in c){if(e.SocNetLogDestination.obDepartmentSelectDisable[n]&&b=="department"){continue}for(var S in e.SocNetLogDestination.obItems[n][b]){if(e.SocNetLogDestination.obItemsSelected[n][S]){continue}d=t.toLowerCase().split(" ");if(d.length<=1){if(e.SocNetLogDestination.obItems[n][b][S].name.toLowerCase().indexOf(t.toLowerCase())<0){continue}else{p=true}}else{l=e.SocNetLogDestination.obItems[n][b][S].name.toLowerCase().split(" ");p=true;for(var u in d){m=false;for(var f in l){if(l[f].indexOf(d[u])>=0){m=true;break}}if(!m){p=false;break}}if(!p){continue}}c[b][S]=true;if(r<=0){var g=e.clone(e.SocNetLogDestination.obItems[n][b][S]);g.type=b;e.SocNetLogDestination.obSearchFirstElement=g}r++}}if(o){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(c,true,n)}else{if(r>0){e.SocNetLogDestination.openSearch(c,n,a)}}}else{if(r<=0){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.destroy()}if(e.SocNetLogDestination.obAllowAddSocNetGroup[n]){e.SocNetLogDestination.createSonetGroupTimeout=setTimeout(function(){if(e.SocNetLogDestination.createSocNetGroupWindow===null){e.SocNetLogDestination.createSocNetGroupWindow=new e.PopupWindow("invite-dialog-creategroup-popup",e.SocNetLogDestination.obElementBindSearchPopup[n].node,{offsetTop:1,autoHide:true,content:e.SocNetLogDestination.createSocNetGroupContent(t),zIndex:1200,buttons:e.SocNetLogDestination.createSocNetGroupButtons(t,n)})}else{e.SocNetLogDestination.createSocNetGroupWindow.setContent(e.SocNetLogDestination.createSocNetGroupContent(t));e.SocNetLogDestination.createSocNetGroupWindow.setButtons(e.SocNetLogDestination.createSocNetGroupButtons(t,n))}if(e.SocNetLogDestination.createSocNetGroupWindow.popupContainer.style.display!="block"){e.SocNetLogDestination.createSocNetGroupWindow.show()}},1e3)}}else{if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(c,true,n)}else{e.SocNetLogDestination.openSearch(c,n,a)}}}clearTimeout(e.SocNetLogDestination.searchTimeout);if(o&&t.toLowerCase()!=""){e.SocNetLogDestination.searchTimeout=setTimeout(function(){e.ajax({url:e.SocNetLogDestination.obPathToAjax[n],method:"POST",dataType:"json",data:{LD_SEARCH:"Y",CRM_SEARCH:e.SocNetLogDestination.obCrmFeed[n]?"Y":"N",EXTRANET_SEARCH:e.util.in_array(e.SocNetLogDestination.obUserSearchArea[n],["I","E"])?e.SocNetLogDestination.obUserSearchArea[n]:"N",SEARCH:t.toLowerCase(),sessid:e.bitrix_sessid(),nt:i,DEPARTMENT_ID:parseInt(e.SocNetLogDestination.obSiteDepartmentID[n])>0?parseInt(e.SocNetLogDestination.obSiteDepartmentID[n]):0},onsuccess:function(o){for(var a in o.USERS){p=true;if(!e.SocNetLogDestination.obItems[n].users[a]){e.SocNetLogDestination.obItems[n].users[a]=o.USERS[a]}}if(e.SocNetLogDestination.obCrmFeed[n]){var c={contacts:"CONTACTS",companies:"COMPANIES",leads:"LEADS",deals:"DEALS"};for(type in c){for(var a in o[c[type]]){p=true;if(!e.SocNetLogDestination.obItems[n][type][a])e.SocNetLogDestination.obItems[n][type][a]=o[c[type]][a]}}}if(!p){if(!s&&e.message("LANGUAGE_ID")=="ru"&&e.correctText){var r=e.correctText(t);if(r!=t){e.SocNetLogDestination.search(r,true,n,i,{bTranslated:true})}else{e.SocNetLogDestination.search(t,false,n,i)}}else{e.SocNetLogDestination.search(t,false,n,i)}}else{e.SocNetLogDestination.search(t,false,n,i)}},onfailure:function(e){}})},1e3)}}};e.SocNetLogDestination.openSearch=function(t,o,n){if(!o)o="lm";if(!n)n={};if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.close();if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close();return false}e.SocNetLogDestination.popupSearchWindow=new e.PopupWindow("BXSocNetLogDestinationSearch",n.bindNode||e.SocNetLogDestination.obElementBindSearchPopup[o].node,{autoHide:true,zIndex:100,offsetLeft:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetTop),bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[o]?{top:"12px",right:"15px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].openSearch)e.SocNetLogDestination.obCallback[o].openSearch(o)},onPopupClose:function(){this.destroy();if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].closeSearch)e.SocNetLogDestination.obCallback[o].closeSearch(o)},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupSearchWindow=null;e.SocNetLogDestination.popupSearchWindowContent=null},this)},content:'<div class="bx-finder-box bx-lm-box '+e.SocNetLogDestination.obWindowClass[o]+'" style="min-width: 450px; padding-bottom: 8px;">'+'<div class="bx-finder-box-tabs-content">'+'<table class="bx-finder-box-tabs-content-table">'+"<tr>"+'<td class="bx-finder-box-tabs-content-cell">'+'<div id="bx-lm-box-search-content" class="bx-finder-box-tab-content bx-finder-box-tab-content-selected">'+e.SocNetLogDestination.getItemLastHtml(t,true,o)+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"});e.SocNetLogDestination.popupSearchWindow.setAngle({});e.SocNetLogDestination.popupSearchWindow.show();e.SocNetLogDestination.popupSearchWindowContent=e("bx-lm-box-search-content")};e.SocNetLogDestination.getItemLastHtml=function(t,o,n){if(!n)n="lm";if(!t)t=e.SocNetLogDestination.obItemsLast[n];var i="";var a=0;if(e.SocNetLogDestination.obCrmFeed[n]){c="";for(var s in t.contacts){if(!e.SocNetLogDestination.obItems[n].contacts[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].contacts[s],{className:"bx-lm-element-contacts",itemType:"contacts",search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-last">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_CONTACTS")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}c="";for(var s in t.companies){if(!e.SocNetLogDestination.obItems[n].companies[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].companies[s],{className:"bx-lm-element-companies",itemType:"companies",search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-last">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_COMPANIES")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}c="";for(var s in t.leads){if(!e.SocNetLogDestination.obItems[n].leads[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].leads[s],{className:"bx-lm-element-leads",itemType:"leads",avatarLessMode:true,search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-last">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_LEADS")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}c="";for(var s in t.deals){if(!e.SocNetLogDestination.obItems[n].deals[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].deals[s],{className:"bx-lm-element-deals",itemType:"deals",avatarLessMode:true,search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-last">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_DEALS")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}}if(o||!e.SocNetLogDestination.obCrmFeed[n]){var c="";for(var s in t.groups){if(!e.SocNetLogDestination.obItems[n].groups[s])continue;c=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].groups[s],{className:"bx-lm-element-groups",descLessMode:true,itemType:"groups",search:o,itemHover:o&&a<=0?true:false});a++}for(var s in t.users){if(!e.SocNetLogDestination.obItems[n].users[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].users[s],{className:"bx-lm-element-user",descLessMode:true,itemType:"users",search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-last">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_USERS")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}c="";for(var s in t.sonetgroups){if(!e.SocNetLogDestination.obItems[n].sonetgroups[s]){continue}c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].sonetgroups[s],{className:"bx-lm-element-sonetgroup"+(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[n].sonetgroups[s].entityId,window["arExtranetGroupID"])?" bx-lm-element-extranet":""),descLessMode:true,itemType:"sonetgroups",search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-sonetgroup">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_SG")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}if(e.SocNetLogDestination.obDepartmentEnable[n]){c="";for(var s in t.department){if(!e.SocNetLogDestination.obItems[n].department[s])continue;c+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n].department[s],{className:"bx-lm-element-department",descLessMode:true,itemType:"department",search:o,itemHover:o&&a<=0?true:false});a++}if(c!=""){i+='<span class="bx-finder-groupbox bx-lm-groupbox-department">'+'<span class="bx-finder-groupbox-name">'+e.message("LM_POPUP_TAB_LAST_STRUCTURE")+":</span>"+'<span class="bx-finder-groupbox-content">'+c+"</span>"+"</span>"}}}if(i.length<=0){i='<span class="bx-finder-groupbox bx-lm-groupbox-search">'+'<span class="bx-finder-groupbox-content">'+e.message(o?"LM_SEARCH_PLEASE_WAIT":"LM_EMPTY_LIST")+"</span>"+"</span>"}return i};e.SocNetLogDestination.getItemGroupHtml=function(t){if(!t)t="lm";var o="";for(var n in e.SocNetLogDestination.obItems[t].sonetgroups){o+=e.SocNetLogDestination.getHtmlByTemplate7(t,e.SocNetLogDestination.obItems[t].sonetgroups[n],{className:"bx-lm-element-sonetgroup"+(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[t].sonetgroups[n].entityId,window["arExtranetGroupID"])?" bx-lm-element-extranet":""),descLessMode:true,itemType:"sonetgroups"})}return o};e.SocNetLogDestination.getItemDepartmentHtml=function(t,o,n,i){if(!t)t="lm";n=n?n:false;i=i?true:false;var a=false;if(typeof o=="undefined"||!o){o=e.SocNetLogDestination.obItems[t].departmentRelation;a=true}var s="";for(var c in o){if(o[c].type=="category"){var r=e.SocNetLogDestination.obItems[t].department[o[c].id];var l=e.SocNetLogDestination.obItemsSelected[t][o[c].id]?"bx-finder-company-department-check-checked":"";s+='<div class="bx-finder-company-department'+(a?" bx-finder-company-department-opened":"")+'"><a href="#'+r.id+'" class="bx-finder-company-department-inner" onclick="return BX.SocNetLogDestination.OpenCompanyDepartment(\''+t+"', this.parentNode, '"+r.entityId+'\')" hidefocus="true"><div class="bx-finder-company-department-arrow"></div><div class="bx-finder-company-department-text">'+r.name+"</div></a></div>";s+='<div class="bx-finder-company-department-children'+(a?" bx-finder-company-department-children-opened":"")+'">';if(!e.SocNetLogDestination.obDepartmentSelectDisable[t]&&!a){s+='<a class="bx-finder-company-department-check '+l+' bx-finder-element" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department', '"+o[c].id+"', 'department')\" rel=\""+o[c].id+'" href="#'+o[c].id+'">';s+='<span class="bx-finder-company-department-check-inner">						<div class="bx-finder-company-department-check-arrow"></div>						<div class="bx-finder-company-department-check-text" rel="'+r.name+": "+e.message("LM_POPUP_CHECK_STRUCTURE")+'">'+e.message("LM_POPUP_CHECK_STRUCTURE")+"</div>					</span>				</a>"}s+=e.SocNetLogDestination.getItemDepartmentHtml(t,o[c].items,r.entityId,a);s+="</div>"}}if(n){s+='<div class="bx-finder-company-department-employees" id="bx-lm-category-relation-'+n+'">';userCount=0;for(var c in o){if(o[c].type=="user"){var d=e.SocNetLogDestination.obItems[t].users[o[c].id];if(d==null)continue;var l=e.SocNetLogDestination.obItemsSelected[t][o[c].id]?"bx-finder-company-department-employee-selected":"";s+='<a href="#'+d.id+'" class="bx-finder-company-department-employee '+l+' bx-finder-element" rel="'+d.id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+d.id+'\', \'users\')" hidefocus="true">					<div class="bx-finder-company-department-employee-info">						<div class="bx-finder-company-department-employee-name">'+d.name+'</div>						<div class="bx-finder-company-department-employee-position">'+d.desc+'</div>					</div>					<div style="'+(d.avatar?"background:url('"+d.avatar+"') no-repeat center center":"")+'" class="bx-finder-company-department-employee-avatar"></div>				</a>';userCount++}}if(userCount<=0){if(!e.SocNetLogDestination.obDepartmentLoad[t][n])s+='<div class="bx-finder-company-department-employees-loading">'+e.message("LM_PLEASE_WAIT")+"</div>";if(i)e.SocNetLogDestination.getDepartmentRelation(t,n)}s+="</div>"}return s};e.SocNetLogDestination.getDepartmentRelation=function(t,o){if(e.SocNetLogDestination.obDepartmentLoad[t][o])return false;e.ajax({url:e.SocNetLogDestination.obPathToAjax[t],method:"POST",dataType:"json",data:{LD_DEPARTMENT_RELATION:"Y",DEPARTMENT_ID:o,sessid:e.bitrix_sessid()},onsuccess:function(n){e.SocNetLogDestination.obDepartmentLoad[t][o]=true;var i=e.util.object_search_key(o=="EX"?o:"DR"+o,e.SocNetLogDestination.obItems[t].departmentRelation);html="";for(var a in n.USERS){if(!e.SocNetLogDestination.obItems[t].users[a]){e.SocNetLogDestination.obItems[t].users[a]=n.USERS[a]}if(!i.items[a]){i.items[a]={id:a,type:"user"};var s=e.SocNetLogDestination.obItemsSelected[t][n.USERS[a].id]?"bx-finder-company-department-employee-selected":"";html+='<a href="#'+n.USERS[a].id+'" class="bx-finder-company-department-employee '+s+' bx-finder-element" rel="'+n.USERS[a].id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+n.USERS[a].id+'\', \'users\')" hidefocus="true">						<div class="bx-finder-company-department-employee-info">							<div class="bx-finder-company-department-employee-name">'+n.USERS[a].name+'</div>							<div class="bx-finder-company-department-employee-position">'+n.USERS[a].desc+'</div>						</div>						<div style="'+(n.USERS[a].avatar?"background:url('"+n.USERS[a].avatar+"') no-repeat center center":"")+'" class="bx-finder-company-department-employee-avatar"></div>					</a>'}}e("bx-lm-category-relation-"+o).innerHTML=html},onfailure:function(e){}})};e.SocNetLogDestination.getHtmlByTemplate1=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-selected":"";var a=n.itemHover?"bx-finder-box-item-hover":"";var s='<a class="bx-finder-box-item '+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 1, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">		<div class="bx-finder-box-item-text">'+o.name+"</div>	</a>";return s};e.SocNetLogDestination.getHtmlByTemplate2=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-t2-selected":"";var a=n.itemHover?"bx-finder-box-item-t2-hover":"";var s='<a class="bx-finder-box-item-t2 '+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 2, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">		<div class="bx-finder-box-item-t2-text">'+o.name+"</div>	</a>";return s};e.SocNetLogDestination.getHtmlByTemplate3=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-t3-selected":"";var a=n.itemHover?"bx-finder-box-item-t3-hover":"";var s='<a hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 3, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="bx-finder-box-item-t3 '+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t3-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t3-info">'+'<div class="bx-finder-box-item-t3-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t3-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate5=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-t5-selected":"";var a=n.itemHover?"bx-finder-box-item-t5-hover":"";var s='<a hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 5, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="bx-finder-box-item-t5 '+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t5-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t5-info">'+'<div class="bx-finder-box-item-t5-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t5-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate6=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-t6-selected":"";var a=n.itemHover?"bx-finder-box-item-t6-hover":"";var s='<a hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 6, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="bx-finder-box-item-t6 '+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t6-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t6-info">'+'<div class="bx-finder-box-item-t6-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t6-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate7=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.type.isNotEmptyString(o.desc);i=n.descLessMode&&n.descLessMode==true?false:i;var a="bx-finder-box-item-t7 bx-finder-element";a+=e.SocNetLogDestination.obItemsSelected[t][o.id]?" bx-finder-box-item-t7-selected":"";a+=n.itemHover?" bx-finder-box-item-t7-hover":"";a+=i?" bx-finder-box-item-t7-desc-mode":"";a+=n.className?" "+n.className:"";a+=n.avatarLessMode&&n.avatarLessMode==true?" bx-finder-box-item-t7-avatarless":"";a+=typeof(o.isExtranet!="undefined")&&o.isExtranet=="Y"?" bx-lm-element-extranet":"";var s='<a hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 7, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+a+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t7-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center;\"":"")+"></div>"+'<div class="bx-finder-box-item-t7-space"></div>'+'<div class="bx-finder-box-item-t7-info">'+'<div class="bx-finder-box-item-t7-name">'+o.name+"</div>"+(i?'<div class="bx-finder-box-item-t7-desc">'+o.desc+"</div>":"")+"</div>"+"</a>";return s};e.SocNetLogDestination.SwitchTab=function(t,o,n){var i=e.findChildren(e.findChild(o.parentNode.parentNode,{tagName:"td",className:"bx-finder-box-tabs-content-cell"},true),{tagName:"div"});if(!i){return false}var a=0;var s=e.findChildren(o.parentNode,{tagName:"a"});for(var c=0;c<s.length;c++){if(s[c]===o){e.addClass(s[c],"bx-finder-box-tab-selected");a=c}else e.removeClass(s[c],"bx-finder-box-tab-selected")}for(c=0;c<i.length;c++){if(a===c){if(n=="last")i[c].innerHTML=e.SocNetLogDestination.getItemLastHtml(false,false,t);else if(n=="group")i[c].innerHTML=e.SocNetLogDestination.getItemGroupHtml(t);else if(n=="department")i[c].innerHTML=e.SocNetLogDestination.getItemDepartmentHtml(t);e.addClass(i[c],"bx-finder-box-tab-content-selected")}else e.removeClass(i[c],"bx-finder-box-tab-content-selected")}e.focus(e.SocNetLogDestination.obElementSearchInput[t]);return false};e.SocNetLogDestination.OpenCompanyDepartment=function(t,o,n){if(!t)t="lm";e.toggleClass(o,"bx-finder-company-department-opened");var i=e.findNextSibling(o,{tagName:"div"});if(e.hasClass(i,"bx-finder-company-department-children"))e.toggleClass(i,"bx-finder-company-department-children-opened");e.SocNetLogDestination.getDepartmentRelation(t,n);return false};Object.size=function(e){var t=0,o;for(o in e){if(e.hasOwnProperty(o))t++}return t};e.SocNetLogDestination.selectItem=function(t,o,n,i,a,s){if(!t)t="lm";e.focus(e.SocNetLogDestination.obElementSearchInput[t]);if(e.SocNetLogDestination.obItemsSelected[t][i])return e.SocNetLogDestination.unSelectItem(t,o,n,i,a,s);e.SocNetLogDestination.obItemsSelected[t][i]=a;e.SocNetLogDestination.obItemsLast[t][a][i]=i;if(!(o==null||n==null)){if(n==1)e.addClass(o,"bx-finder-box-item-selected");else if(n==2)e.addClass(o,"bx-finder-box-item-t2-selected");else if(n==3)e.addClass(o,"bx-finder-box-item-t3-selected");else if(n==4)e.addClass(o,"bx-finder-box-item-t3-selected");else if(n==5)e.addClass(o,"bx-finder-box-item-t5-selected");else if(n==6)e.addClass(o,"bx-finder-box-item-t6-selected");else if(n==7)e.addClass(o,"bx-finder-box-item-t7-selected");else if(n=="department-user")e.addClass(o,"bx-finder-company-department-employee-selected");else if(n=="department")e.addClass(o,"bx-finder-company-department-check-checked")}e.SocNetLogDestination.runSelectCallback(i,a,t,s);if(s===true){if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.close();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.close()}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}var c=Object.size(e.SocNetLogDestination.obItemsLast[t][a]);if(c>5){var r={};var l=0;var d=c-5;for(var p in e.SocNetLogDestination.obItemsLast[t][a]){if(l>=d)r[e.SocNetLogDestination.obItemsLast[t][a][p]]=e.SocNetLogDestination.obItemsLast[t][a][p];l++}}else{var r=e.SocNetLogDestination.obItemsLast[t][a]}e.userOptions.save("socialnetwork","log_destination",a,JSON.stringify(r));if(e.util.in_array(a,["contacts","companies","leads","deals"])&&e.SocNetLogDestination.obCrmFeed[t]){var m=[i];for(var p=0;p<e.SocNetLogDestination.obItemsLast[t].crm.length&&m.length<20;p++){if(e.SocNetLogDestination.obItemsLast[t].crm[p]!=i)m.push(e.SocNetLogDestination.obItemsLast[t].crm[p])}e.SocNetLogDestination.obItemsLast[t].crm=m;e.userOptions.save("crm","log_destination","items",m)}return false};e.SocNetLogDestination.unSelectItem=function(t,o,n,i,a,s){if(!t)t="lm";if(!e.SocNetLogDestination.obItemsSelected[t][i])return false;if(n==1)e.removeClass(o,"bx-finder-box-item-selected");else if(n==2)e.removeClass(o,"bx-finder-box-item-t2-selected");else if(n==3)e.removeClass(o,"bx-finder-box-item-t3-selected");else if(n==4)e.removeClass(o,"bx-finder-box-item-t3-selected");else if(n==5)e.removeClass(o,"bx-finder-box-item-t5-selected");else if(n==6)e.removeClass(o,"bx-finder-box-item-t6-selected");else if(n==7)e.removeClass(o,"bx-finder-box-item-t7-selected");else if(n=="department-user")e.removeClass(o,"bx-finder-company-department-employee-selected");
else if(n=="department")e.removeClass(o,"bx-finder-company-department-check-checked");e.SocNetLogDestination.runUnSelectCallback(i,a,t,s);if(s===true){if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.close();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.close()}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}return false};e.SocNetLogDestination.runSelectCallback=function(t,o,n,i){if(!n){n="lm"}if(!i){i=false}if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].select&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t]){e.SocNetLogDestination.obCallback[n].select(e.SocNetLogDestination.obItems[n][o][t],o,i,false,n)}};e.SocNetLogDestination.runUnSelectCallback=function(t,o,n,i){if(!n)n="lm";if(!i)i=false;delete e.SocNetLogDestination.obItemsSelected[n][t];if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].unSelect&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t])e.SocNetLogDestination.obCallback[n].unSelect(e.SocNetLogDestination.obItems[n][o][t],o,i,n)};e.SocNetLogDestination.deleteItem=function(t,o,n){if(!n)n="lm";e.SocNetLogDestination.runUnSelectCallback(t,o,n)};e.SocNetLogDestination.deleteLastItem=function(t){if(!t)t="lm";var o=false;for(var n in e.SocNetLogDestination.obItemsSelected[t])o=n;if(o){var i=e.SocNetLogDestination.obItemsSelected[t][o];e.SocNetLogDestination.runUnSelectCallback(o,i,t)}};e.SocNetLogDestination.selectFirstSearchItem=function(t){if(!t)t="lm";var o=e.SocNetLogDestination.obSearchFirstElement;if(o!=null){e.SocNetLogDestination.selectItem(t,null,null,o.id,o.type,true);e.SocNetLogDestination.obSearchFirstElement=null}};e.SocNetLogDestination.getSelectedCount=function(t){if(!t)t="lm";var o=0;for(var n in e.SocNetLogDestination.obItemsSelected[t])o++;return o};e.SocNetLogDestination.getSelected=function(t){if(!t)t="lm";return e.SocNetLogDestination.obItemsSelected[t]};e.SocNetLogDestination.isOpenDialog=function(){return e.SocNetLogDestination.popupWindow!=null?true:false};e.SocNetLogDestination.isOpenSearch=function(){return e.SocNetLogDestination.popupSearchWindow!=null?true:false};e.SocNetLogDestination.closeDialog=function(t){t=t===true?true:false;if(e.SocNetLogDestination.popupWindow!=null)if(t)e.SocNetLogDestination.popupWindow.destroy();else e.SocNetLogDestination.popupWindow.close();return true};e.SocNetLogDestination.closeSearch=function(){if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.close();return true};e.SocNetLogDestination.createSocNetGroupContent=function(t){return e.create("div",{children:[e.create("div",{text:e.message("LM_CREATE_SONETGROUP_TITLE").replace("#TITLE#",t)})]})};e.SocNetLogDestination.createSocNetGroupButtons=function(t,o){var n=[new e.PopupWindowButton({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CREATE"),events:{click:function(){var n="SGN"+e.SocNetLogDestination.obNewSocNetGroupCnt[o]+"";e.SocNetLogDestination.obItems[o]["sonetgroups"][n]={id:n,entityId:e.SocNetLogDestination.obNewSocNetGroupCnt[o],name:t,desc:""};var i={sonetgroups:{}};i["sonetgroups"][n]=true;if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(i,true,o)}else{e.SocNetLogDestination.openSearch(i,o)}e.SocNetLogDestination.obNewSocNetGroupCnt[o]++;e.SocNetLogDestination.createSocNetGroupWindow.close()}}}),new e.PopupWindowButtonLink({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){e.SocNetLogDestination.createSocNetGroupWindow.close()}}})];return n}})();
//# sourceMappingURL=log-destination.map.js